{"version":3,"sources":["webpack://squarefall/./src/constants.js","webpack://squarefall/./src/grid/grid.js","webpack://squarefall/./src/score/score.js","webpack://squarefall/./src/speed/speed.js","webpack://squarefall/./src/game/game.js","webpack://squarefall/./src/point/point.js","webpack://squarefall/./src/square/square.js","webpack://squarefall/./src/shape/shape.js","webpack://squarefall/./src/bootstrap.js","webpack://squarefall/./src/shape-generator/shape-generator.js"],"names":["SQUARE_SIDE_LENGTH","Grid","canvas","context","this","shapes","movingShape","undefined","thereIsRoomToMoveDown","moveDown","thereIsRoomToMoveLeft","moveLeft","thereIsRoomToMoveRight","moveRight","moveShapeDown","points","squares","map","square","point","shape","otherPoints","filter","some","otherPoint","x","y","length","clear","rotateClockwise","allPointsFitInsideGrid","noOtherShapeIsInTheWay","rotateCounterClockwise","draw","every","width","height","getLargestY","noOtherShapeIsInTheWayDown","getSmallestX","noOtherShapeIsInTheWayLeft","getLargestX","noOtherShapeIsInTheWayRight","amountOfPointsInRow","rowCount","fullRowCount","i","occupiedSquaresAndShapes","Map","set","size","remove","shiftDownward","rowIndex","yLimit","clearAndMoveSquaresBelowYLimit","otherShape","hasCommonPointWith","strokeStyle","beginPath","moveTo","lineTo","stroke","drawPoints","drawCoordinates","hasOccupiedPoint","includes","allRows","row","Score","high","getHighScore","document","getElementById","innerText","current","highScore","localStorage","getItem","rowsCleared","value","newValue","setItem","classList","add","setTimeout","Speed","delay","desiredSpeed","increase","Game","shapeGenerator","setCanvasWidth","setCanvasHeight","window","hidden","style","display","grid","generatedShape","generateShape","push","score","speed","SCORE_PER_SPEED_INCREASE","MAX_SPEED","paused","event","key","pause","keyPressed","moveShapeLeft","rotateShape","moveShapeRight","clearInterval","heartbeatInterval","moveShapeToBottom","removeFullRows","requestScoreIncrease","requestSpeedIncrease","end","setInterval","self","heartbeat","drawAllPoints","drawEdgePoints","drawLines","keyHandler","bind","addEventListener","pauseKeyHandler","isPaused","screen","availWidth","desiredHeight","availHeight","submit","showGameOverText","removeEventListener","currentSpeed","Math","trunc","get","increaseIfNecessary","increment","Point","oldX","oldY","translate","offsetX","offsetY","Square","fillStyle","sideLength","fillRect","arc","PI","fillText","drawEdgePoint","color","clearRect","otherSquare","equals","transformClockwise","transformCounterClockwise","occupiesCoordinates","Shape","pointOfTranslation","pointOfTranslationSquare","otherSquares","largestY","calculateLargestY","smallestX","calculateSmallestX","largestX","calculateLargestX","getPointOfTranslationX","squareToRemove","Object","prototype","hasOwnProperty","call","forEach","drawPoint","thisPoint","sort","pop","shift","redraw","isBelowLimit","clearAndMoveDown","I","xCoordOfAppearance","super","init","O","point1","point2","point3","L","J","S","Z","T","createElement","setAttribute","append","getContext","shapeTypesAsArray","values","ChosenShapeType","round","random"],"mappings":"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","file":"main.js","sourcesContent":["export const SQUARE_SIDE_LENGTH = 50\n","import {\n  SQUARE_SIDE_LENGTH\n} from '../constants.js'\n\nexport const emptySquareCharacter = '\\u2b1c'\nexport const fullSquareCharacter = '\\u2b1b'\n\nexport default class Grid {\n  constructor (canvas, context) {\n    this.canvas = canvas\n    this.context = context\n    this.shapes = []\n    this.movingShape = undefined\n  }\n\n  moveShapeDown () {\n    if (this.thereIsRoomToMoveDown()) {\n      this.movingShape.moveDown()\n    }\n  }\n\n  moveShapeLeft () {\n    if (this.thereIsRoomToMoveLeft()) {\n      this.movingShape.moveLeft()\n    }\n  }\n\n  moveShapeRight () {\n    if (this.thereIsRoomToMoveRight()) {\n      this.movingShape.moveRight()\n    }\n  }\n\n  moveShapeToBottom () {\n    while (this.thereIsRoomToMoveDown()) {\n      this.moveShapeDown()\n    }\n  }\n\n  noOtherShapeIsInTheWayDown () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint =>\n              otherPoint.x === point.x &&\n              otherPoint.y === point.y + SQUARE_SIDE_LENGTH)\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  noOtherShapeIsInTheWayLeft () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint =>\n              otherPoint.x + SQUARE_SIDE_LENGTH === point.x &&\n              otherPoint.y === point.y)\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  noOtherShapeIsInTheWayRight () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint =>\n              otherPoint.x === point.x + SQUARE_SIDE_LENGTH &&\n              otherPoint.y === point.y)\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  rotateShape () {\n    this.movingShape.clear()\n    this.movingShape.rotateClockwise()\n\n    if (!(this.allPointsFitInsideGrid() && this.noOtherShapeIsInTheWay(this.movingShape))) {\n      this.movingShape.rotateCounterClockwise()\n    }\n\n    this.movingShape.draw()\n  }\n\n  allPointsFitInsideGrid () {\n    return this.movingShape.squares.map(square => square.point.x)\n      .every(x => x >= 0 && x <= this.canvas.width - SQUARE_SIDE_LENGTH) &&\n      this.movingShape.squares.map(square => square.point.y)\n        .every(y => y >= 0 && y <= this.canvas.height - SQUARE_SIDE_LENGTH)\n  }\n\n  thereIsRoomToMoveDown () {\n    const largestY = this.movingShape.getLargestY()\n    return (largestY + SQUARE_SIDE_LENGTH < this.canvas.height) && this.noOtherShapeIsInTheWayDown()\n  }\n\n  thereIsRoomToMoveLeft () {\n    return this.movingShape.getSmallestX() - SQUARE_SIDE_LENGTH >= 0 && this.noOtherShapeIsInTheWayLeft()\n  }\n\n  thereIsRoomToMoveRight () {\n    return this.movingShape.getLargestX() + SQUARE_SIDE_LENGTH < this.canvas.width && this.noOtherShapeIsInTheWayRight()\n  }\n\n  removeFullRows () {\n    const amountOfPointsInRow = this.canvas.width / SQUARE_SIDE_LENGTH\n    const rowCount = this.canvas.height / SQUARE_SIDE_LENGTH\n    let fullRowCount = 0\n\n    for (let i = 0; i < rowCount; i += 1) {\n      const occupiedSquaresAndShapes = new Map()\n      for (const shape of this.shapes) {\n        for (const square of shape.squares) {\n          if (square.point.y === i * SQUARE_SIDE_LENGTH) {\n            occupiedSquaresAndShapes.set(square, shape)\n          }\n        }\n      }\n\n      if (occupiedSquaresAndShapes.size === amountOfPointsInRow) {\n        fullRowCount += 1\n        for (const [square, shape] of occupiedSquaresAndShapes) {\n          square.clear()\n          shape.remove(square)\n        }\n        this.shiftDownward(i)\n      }\n    }\n    return fullRowCount\n  }\n\n  shiftDownward (rowIndex) {\n    //  Everything that is above this rowIndex must shift down by SIDE_LENGTH.\n    const yLimit = rowIndex * SQUARE_SIDE_LENGTH\n    for (const shape of this.shapes) {\n      const redraw = shape.clearAndMoveSquaresBelowYLimit(yLimit)\n      if (redraw) {\n        shape.draw()\n      }\n    }\n  }\n\n  noOtherShapeIsInTheWay (shape) {\n    for (const otherShape of this.shapes) {\n      if (otherShape !== shape) {\n        if (otherShape.hasCommonPointWith(shape)) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  drawLines () {\n    const rowCount = this.canvas.height / SQUARE_SIDE_LENGTH\n    for (let i = 1; i < rowCount; i += 1) {\n      this.context.strokeStyle = 'black'\n      this.context.beginPath()\n      this.context.moveTo(0, i * SQUARE_SIDE_LENGTH)\n      this.context.lineTo(this.canvas.width, i * SQUARE_SIDE_LENGTH)\n      this.context.stroke()\n    }\n  }\n\n  drawAllPoints () {\n    for (const shape of this.shapes) {\n      shape.drawPoints()\n    }\n  }\n\n  drawCoordinates () {\n    for (const shape of this.shapes) {\n      shape.drawCoordinates()\n    }\n  }\n\n  hasOccupiedPoint (x, y) {\n    const hasOccupiedPointPerShape = this.shapes.map(shape => shape.hasOccupiedPoint(x, y))\n    return hasOccupiedPointPerShape.includes(true)\n  }\n\n  print () {\n    let allRows = ''\n    for (let y = 0; y < this.canvas.height; y += SQUARE_SIDE_LENGTH) {\n      let row = ''\n      for (let x = 0; x < this.canvas.width; x += SQUARE_SIDE_LENGTH) {\n        if (this.hasOccupiedPoint(x, y)) {\n          row += fullSquareCharacter\n        } else {\n          row += emptySquareCharacter\n        }\n      }\n      if (y !== this.canvas.height - SQUARE_SIDE_LENGTH) {\n        row += '\\n'\n      }\n      allRows += row\n    }\n    return allRows\n  }\n}\n","export default class Score {\n  constructor () {\n    this.high = Score.getHighScore()\n    document.getElementById('high-score').innerText = this.high\n    this.current = 0\n  }\n\n  static getHighScore () {\n    let highScore = localStorage.getItem('tetris-high')\n    if (highScore === undefined) {\n      highScore = 0\n    }\n    return highScore\n  }\n\n  static calculateIncrease (rowsCleared) {\n    const score = (2 ** rowsCleared) + 2\n    return score\n  }\n\n  increment (value) {\n    this.current += value\n    document.getElementById('current-score').innerText = this.current\n  }\n\n  get () {\n    return this.current\n  }\n\n  set (newValue) {\n    this.current = newValue\n  }\n\n  submit () {\n    if (this.current > this.high) {\n      localStorage.setItem('tetris-high', this.current)\n      document.getElementById('high-score').innerText = this.current\n      document.getElementById('scoreContainer').classList.add('shaken')\n      setTimeout(\n        () => document.getElementById('scoreContainer').classList.remove('shaken'),\n        1000\n      )\n    }\n  }\n}\n","export default class Speed {\n  constructor () {\n    this.value = 0\n    this.delay = 1000\n  }\n\n  increase () {\n    this.value += 1\n    this.delay = 1000 - 100 * this.value\n  }\n\n  increaseIfNecessary (desiredSpeed) {\n    if (desiredSpeed > this.value) {\n      this.increase()\n      document.getElementById('speedContainer').classList.add('shaken')\n      setTimeout(\n        () => document.getElementById('speedContainer').classList.remove('shaken'),\n        1000\n      )\n    }\n    return this.value\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nimport Grid from '../grid/grid.js'\nimport Score from '../score/score.js'\nimport Speed from '../speed/speed.js'\n\nexport class Game {\n  constructor (canvas, context, shapeGenerator) {\n    this.canvas = canvas\n    this.context = context\n    this.shapeGenerator = shapeGenerator\n  }\n\n  init () {\n    this.setCanvasWidth()\n    this.setCanvasHeight()\n\n    window.setTimeout(() => {\n      document.getElementById('loading').hidden = true\n      document.getElementById('container').style.display = 'grid'\n    }, 200) // to allow the user some time to spot the loading text\n\n    this.grid = new Grid(this.canvas, this.context)\n    const generatedShape = this.shapeGenerator.generateShape()\n    this.grid.shapes.push(generatedShape)\n    this.grid.movingShape = generatedShape\n    generatedShape.draw()\n    this.score = new Score()\n    this.speed = new Speed()\n    document.getElementById('current-speed').innerText = this.speed.value\n    this.SCORE_PER_SPEED_INCREASE = 50\n    this.MAX_SPEED = 9\n    this.paused = (event) => {\n      if (this.grid.movingShape) {\n        switch (event.key) {\n          case 'p': this.pause(); break\n          default: break\n        }\n      }\n    }\n    this.keyPressed = (event) => {\n      if (this.grid.movingShape) {\n        switch (event.key) {\n          case 'j': this.grid.moveShapeLeft(); break\n          case 'k': this.grid.rotateShape(); break\n          case 'l': this.grid.moveShapeRight(); break\n          case ' ':\n            // to avoid possible side effects with several intervals triggering simultaneously or closely after each other\n            window.clearInterval(this.heartbeatInterval)\n            this.heartbeatInterval = undefined\n            this.grid.moveShapeToBottom()\n\n            if (!this.grid.thereIsRoomToMoveDown()) {\n              this.grid.movingShape = undefined\n              const fullRowCount = this.grid.removeFullRows()\n              if (fullRowCount > 0) {\n                this.requestScoreIncrease(fullRowCount)\n                this.requestSpeedIncrease()\n              }\n              const generatedShape = this.shapeGenerator.generateShape()\n              if (this.grid.noOtherShapeIsInTheWay(generatedShape)) {\n                this.grid.shapes.push(generatedShape)\n                generatedShape.draw()\n                this.grid.movingShape = generatedShape\n              } else {\n                this.end()\n              }\n            }\n\n            if (this.grid.movingShape && this.heartbeatInterval === undefined) {\n              this.heartbeatInterval = window.setInterval(() => self.heartbeat(), self.speed.delay)\n            }\n            break\n          case '1': this.grid.drawAllPoints(); break\n          case '2': this.grid.drawCoordinates(); break\n          case '3': this.grid.movingShape.drawEdgePoints(); break\n          case '4': this.grid.drawLines(); break\n          default: break\n        }\n      }\n    }\n    this.keyHandler = this.keyPressed.bind(this)\n    window.addEventListener('keypress', this.keyHandler)\n    this.pauseKeyHandler = this.paused.bind(this)\n    window.addEventListener('keypress', this.pauseKeyHandler)\n\n    const self = this\n    this.heartbeatInterval = window.setInterval(() => self.heartbeat(), self.speed.delay)\n\n    this.isPaused = false\n  }\n\n  setCanvasWidth () {\n    const desiredWidth = 10 * SQUARE_SIDE_LENGTH\n\n    if (desiredWidth < window.screen.availWidth) {\n      this.canvas.width = desiredWidth\n    }\n  }\n\n  setCanvasHeight () {\n    let desiredHeight = window.screen.availHeight\n\n    if (desiredHeight % 100 !== 0) {\n      desiredHeight -= desiredHeight % 100\n    }\n\n    desiredHeight -= 100 // To leave room for browser/OS UI toolbars\n\n    if (desiredHeight > 20 * SQUARE_SIDE_LENGTH) {\n      desiredHeight = 20 * SQUARE_SIDE_LENGTH\n    }\n\n    this.canvas.height = desiredHeight\n  }\n\n  heartbeat () {\n    if (!this.grid.thereIsRoomToMoveDown()) {\n      this.grid.movingShape = undefined\n      const fullRowCount = this.grid.removeFullRows()\n      if (fullRowCount > 0) {\n        this.requestScoreIncrease(fullRowCount)\n        this.requestSpeedIncrease()\n      }\n      const generatedShape = this.shapeGenerator.generateShape()\n      if (this.grid.noOtherShapeIsInTheWay(generatedShape)) {\n        this.grid.shapes.push(generatedShape)\n        generatedShape.draw()\n        this.grid.movingShape = generatedShape\n      } else {\n        this.end()\n      }\n    }\n\n    if (this.grid.movingShape && this.grid.thereIsRoomToMoveDown()) {\n      this.grid.moveShapeDown()\n    }\n  }\n\n  end () {\n    this.score.submit()\n    Game.showGameOverText()\n    window.clearInterval(this.heartbeatInterval)\n    window.removeEventListener('keypress', this.keyHandler)\n    window.removeEventListener('keypress', this.pauseKeyHandler)\n  }\n\n  requestSpeedIncrease () {\n    if (this.speed.value < this.MAX_SPEED) {\n      const currentSpeed = this.speed.value\n      const desiredSpeed = Math.trunc(this.score.get() / this.SCORE_PER_SPEED_INCREASE)\n      const newSpeed = this.speed.increaseIfNecessary(desiredSpeed)\n\n      if (newSpeed > currentSpeed) {\n        window.clearInterval(this.heartbeatInterval)\n        const self = this\n        this.heartbeatInterval = window.setInterval(() => self.heartbeat(), self.speed.delay)\n        document.getElementById('current-speed').innerText = this.speed.value\n      }\n    }\n  }\n\n  requestScoreIncrease (rowsCleared) {\n    this.score.increment(rowsCleared)\n  }\n\n  pause () {\n    if (this.isPaused) {\n      window.addEventListener('keypress', this.keyHandler)\n      const self = this\n      this.heartbeatInterval = window.setInterval(() => self.heartbeat(), this.speed.delay)\n    } else {\n      window.clearInterval(this.heartbeatInterval)\n      window.removeEventListener('keypress', this.keyHandler)\n    }\n    this.isPaused = !this.isPaused\n  }\n\n  static showGameOverText () {\n    document.getElementById('gameOverContainer').hidden = false\n  }\n}\n","import {\n  SQUARE_SIDE_LENGTH\n} from '../constants.js'\n\nexport default class Point {\n  constructor (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  moveDown () {\n    this.y += SQUARE_SIDE_LENGTH\n  }\n\n  moveLeft () {\n    this.x += -SQUARE_SIDE_LENGTH\n  }\n\n  moveRight () {\n    this.x += SQUARE_SIDE_LENGTH\n  }\n\n  transformClockwise (oldX, oldY) {\n    this.translate(-oldX, -oldY)\n    this.rotateClockwise()\n    this.translate(oldX, oldY)\n  }\n\n  transformCounterClockwise (oldX, oldY) {\n    this.translate(-oldX, -oldY)\n    this.rotateCounterClockwise()\n    this.translate(oldX, oldY)\n  }\n\n  translate (offsetX, offsetY) {\n    this.x = this.x + offsetX\n    this.y = this.y + offsetY\n  }\n\n  rotateClockwise () {\n    const oldX = this.x\n    const oldY = this.y\n\n    /*\n    We are performing a clockwise 90 degree rotation in a 2D coordinate system.\n    https://en.wikipedia.org/wiki/Rotation_matrix\n\n    90 degrees = Math.PI / 2 radians\n    Math.sin(Math.PI / 2) = 1\n    Math.cos(Math.PI / 2) = 0\n\n    newX = oldX * 0 - oldY * 1 = -oldY\n    newY = oldX * 1 + oldY * 0 = oldX\n    */\n\n    this.x = -oldY\n    this.y = oldX\n  }\n\n  rotateCounterClockwise () {\n    const oldX = this.x\n    const oldY = this.y\n\n    /*\n    We are performing a counter-clockwise 90 degree rotation in a 2D coordinate system.\n    https://en.wikipedia.org/wiki/Rotation_matrix\n\n    -90 degrees = 3 * Math.PI / 2 radians\n    Math.sin(3 * Math.PI / 2) = -1\n    Math.cos(3 * Math.PI / 2) = 0\n\n    newX = oldX * 0 - oldY * -1 = oldY\n    newY = oldX * -1 + oldY * 0 = -oldX\n    */\n\n    this.x = oldY\n    this.y = -oldX\n  }\n\n  equals (otherPoint) {\n    return otherPoint instanceof Point &&\n      typeof otherPoint.x === 'number' &&\n      typeof otherPoint.y === 'number' &&\n      this.x === otherPoint.x &&\n      this.y === otherPoint.y\n  }\n\n  occupiesCoordinates (x, y) {\n    return this.x === x && this.y === y\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nexport default class Square {\n  constructor (point, fillStyle, context) {\n    // The point of a Square always refers to its top left point\n    this.point = point\n    this.fillStyle = fillStyle\n    this.context = context\n    this.sideLength = SQUARE_SIDE_LENGTH\n  }\n\n  draw () {\n    this.context.beginPath()\n    this.context.fillStyle = this.fillStyle\n    this.context.fillRect(this.point.x, this.point.y, this.sideLength, this.sideLength)\n  }\n\n  drawPoint () {\n    this.context.beginPath()\n    this.context.strokeStyle = 'red'\n    this.context.arc(this.point.x, this.point.y, 10, 0, 2 * Math.PI)\n    this.context.stroke()\n  }\n\n  drawCoordinates () {\n    this.context.fillStyle = 'black'\n    this.context.fillText(`${this.point.x} | ${this.point.y}`, this.point.x, this.point.y)\n  }\n\n  drawEdgePoints () {\n    this.drawEdgePoint('yellow', this.point.x, this.point.y)\n    this.drawEdgePoint('blue', this.point.x + SQUARE_SIDE_LENGTH, this.point.y)\n    this.drawEdgePoint('magenta', this.point.x + SQUARE_SIDE_LENGTH, this.point.y + SQUARE_SIDE_LENGTH)\n    this.drawEdgePoint('black', this.point.x, this.point.y + SQUARE_SIDE_LENGTH)\n  }\n\n  drawEdgePoint (color, x, y) {\n    this.context.beginPath()\n    this.context.strokeStyle = color\n    this.context.arc(x, y, 10, 0, 2 * Math.PI)\n    this.context.stroke()\n  }\n\n  clear () {\n    this.context.clearRect(this.point.x, this.point.y, this.sideLength, this.sideLength)\n  }\n\n  equals (otherSquare) {\n    return otherSquare !== undefined &&\n      otherSquare instanceof Square &&\n      this.sideLength === otherSquare.sideLength &&\n      this.point.equals(otherSquare.point)\n  }\n\n  moveDown () {\n    this.clear()\n    this.point.moveDown()\n    this.draw()\n  }\n\n  clearAndMoveDown () {\n    this.clear()\n    this.point.moveDown()\n  }\n\n  moveLeft () {\n    this.clear()\n    this.point.moveLeft()\n    this.draw()\n  }\n\n  moveRight () {\n    this.clear()\n    this.point.moveRight()\n    this.draw()\n  }\n\n  transformClockwise (x, y) {\n    this.point.transformClockwise(x, y)\n  }\n\n  transformCounterClockwise (x, y) {\n    this.point.transformCounterClockwise(x, y)\n  }\n\n  isBelowLimit (yLimit) {\n    return this.point.y < yLimit\n  }\n\n  hasOccupiedPoint (x, y) {\n    return this.point.occupiesCoordinates(x, y)\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nimport Point from '../point/point.js'\nimport Square from '../square/square.js'\n\nexport class Shape {\n  init (fillStyle, pointOfTranslation, points, context) {\n    this.pointOfTranslation = pointOfTranslation\n\n    const pointOfTranslationSquare = new Square(pointOfTranslation, fillStyle, context)\n    const otherSquares = points.map(point => new Square(point, fillStyle, context))\n\n    this.squares = [pointOfTranslationSquare, ...otherSquares]\n\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n\n    this.context = context\n  }\n\n  getPointOfTranslationX () {\n    return this.getPointOfTranslationX\n  }\n\n  remove (squareToRemove) {\n    if (Object.prototype.hasOwnProperty.call(squareToRemove, 'point') &&\n      Object.prototype.hasOwnProperty.call(squareToRemove.point, 'x') &&\n      Object.prototype.hasOwnProperty.call(squareToRemove.point, 'y')) {\n      this.squares = this.squares.filter(square => !(square.equals(squareToRemove)))\n      this.largestY = this.calculateLargestY()\n      this.smallestX = this.calculateSmallestX()\n      this.largestX = this.calculateLargestX()\n    }\n  }\n\n  draw () {\n    this.squares.forEach(square => square.draw())\n  }\n\n  drawPoints () {\n    this.squares.forEach(square => square.drawPoint())\n  }\n\n  drawCoordinates () {\n    this.squares.forEach((square) => square.drawCoordinates())\n  }\n\n  markPointOfTranslation () {\n    this.context.fillStyle = 'rgba(120, 230, 244, 0.2)'\n\n    this.context.beginPath()\n    this.context.arc(this.pointOfTranslation.x, this.pointOfTranslation.y, 10, 0, 2 * Math.PI)\n    this.context.stroke()\n  }\n\n  drawEdgePoints () {\n    this.squares.forEach(square => {\n      square.drawEdgePoints()\n    })\n  }\n\n  clear () {\n    this.squares.forEach(square => square.clear())\n  }\n\n  rotateClockwise () {\n    this.squares.forEach(square => {\n      square.transformClockwise(this.pointOfTranslation.x, this.pointOfTranslation.y)\n    })\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  rotateCounterClockwise () {\n    this.squares.forEach(square => {\n      square.transformCounterClockwise(this.pointOfTranslation.x, this.pointOfTranslation.y)\n    })\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  hasPoint (otherPoint) {\n    const points = this.squares.map(square => new Point(square.point.x, square.point.y))\n    const thisPoint = points.filter(point => point.equals(otherPoint))\n    return thisPoint !== undefined && thisPoint.length && thisPoint.length !== 0 && thisPoint.equals(otherPoint)\n  }\n\n  hasCommonPointWith (otherShape) {\n    for (const square of this.squares) {\n      for (const otherSquare of otherShape.squares) {\n        if (square.equals(otherSquare)) {\n          return true\n        }\n      }\n    }\n\n    return false\n  }\n\n  moveDown () {\n    this.clear()\n    this.squares.forEach(square => square.moveDown())\n    this.largestY = this.calculateLargestY()\n    this.draw()\n  }\n\n  moveLeft () {\n    this.clear()\n    this.squares.forEach(square => square.moveLeft())\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n    this.draw()\n  }\n\n  moveRight () {\n    this.clear()\n    this.squares.forEach(square => square.moveRight())\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n    this.draw()\n  }\n\n  calculateLargestY () {\n    return this.squares\n      .map(square => square.point.y)\n      .sort()\n      .pop()\n  }\n\n  calculateSmallestX () {\n    return this.squares\n      .map(square => square.point.x)\n      .sort()\n      .shift()\n  }\n\n  calculateLargestX () {\n    return this.squares\n      .map(square => square.point.x)\n      .sort()\n      .pop()\n  }\n\n  getLargestY () {\n    return this.largestY\n  }\n\n  getSmallestX () {\n    return this.smallestX\n  }\n\n  getLargestX () {\n    return this.largestX\n  }\n\n  clearAndMoveSquaresBelowYLimit (yLimit) {\n    let redraw = false\n    this.squares.forEach(square => {\n      if (square.isBelowLimit(yLimit)) {\n        square.clearAndMoveDown()\n        redraw = true\n      }\n    })\n    return redraw\n  }\n\n  hasOccupiedPoint (x, y) {\n    const hasOccupiedPointPerSquare = this.squares.map(square => square.hasOccupiedPoint(x, y))\n    return hasOccupiedPointPerSquare.includes(true)\n  }\n}\n\nclass O extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const point2 = new Point(xCoordOfAppearance, 0)\n    const point3 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'thistle'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  rotateClockwise () { }\n\n  // eslint-disable-next-line class-methods-use-this\n  rotateCounterClockwise () { }\n}\n\nclass T extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH)\n    const point2 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n    const point3 = new Point(xCoordOfAppearance, 0)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'lightgrey'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nclass I extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const pointOfTranslation = new Point(xCoordOfAppearance, 0)\n    const point1 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, 0)\n    const point2 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, 0)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'yellowgreen'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nclass S extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const point2 = new Point(xCoordOfAppearance, 0)\n    const point3 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n    const pointOfTranslation = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'khaki'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nclass Z extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const point2 = new Point(xCoordOfAppearance, 0)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'tan'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nclass L extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, 0)\n    const pointOfTranslation = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const point2 = new Point(xCoordOfAppearance, 0)\n    const point3 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'lightblue'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nclass J extends Shape {\n  constructor (xCoordOfAppearance, context) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0)\n    const pointOfTranslation = new Point(xCoordOfAppearance, 0)\n    const point2 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, 0)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'darksalmon'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context)\n  }\n}\n\nconst shapeTypes = {\n  I,\n  O,\n  L,\n  J,\n  S,\n  Z,\n  T\n}\n\nexport default shapeTypes\n","import { Game } from './game/game.js'\nimport { ShapeGenerator } from './shape-generator/shape-generator.js'\n\nconst canvas = document.createElement('canvas')\ncanvas.setAttribute('id', 'gameCanvas')\n\nconst gameContainer = document.getElementById('gameContainer')\ngameContainer.append(canvas)\n\nconst context = canvas.getContext('2d')\nconst shapeGenerator = new ShapeGenerator(canvas, context)\nconst game = new Game(canvas, context, shapeGenerator)\ngame.init()\n","import shapeTypes from '../shape/shape.js'\n\nexport class ShapeGenerator {\n  constructor (canvas, context) {\n    this.canvas = canvas\n    this.context = context\n  }\n\n  generateShape () {\n    const shapeTypesAsArray = Object.values(shapeTypes)\n    const chosenShapeIndex = Math.round(Math.random() * (shapeTypesAsArray.length - 1))\n    const ChosenShapeType = shapeTypesAsArray[chosenShapeIndex]\n    const xCoordinateOfAppearance = this.canvas.width / 2\n    const shape = new ChosenShapeType(xCoordinateOfAppearance, this.context)\n    return shape\n  }\n}\n"],"sourceRoot":""}